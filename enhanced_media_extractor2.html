<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enhanced Media Extractor V5.0 - Potenziato</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif; background:linear-gradient(135deg,#667eea,#764ba2); min-height:100vh; padding:20px; }
    .container { max-width:1400px; margin:0 auto; background:#fff; border-radius:20px; box-shadow:0 25px 50px rgba(0,0,0,.15); overflow:hidden; }
    .header { background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; padding:40px; text-align:center; position:relative; }
    .header::before { content:''; position:absolute; top:0; left:0; right:0; bottom:0; background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>'); opacity:0.3; }
    .header h1 { font-size:3em; margin-bottom:15px; font-weight:300; position:relative; z-index:1; }
    .header p { opacity:.9; font-size:1.2em; position:relative; z-index:1; }
    .main-content { padding:40px; }

    .tabs-container { margin-bottom:30px; }
    .tabs-nav { display:flex; background:#f8f9fa; border-radius:12px; padding:4px; margin-bottom:20px; }
    .tab-btn { flex:1; padding:12px 20px; border:none; background:transparent; cursor:pointer; border-radius:8px; font-weight:500; transition:.3s; }
    .tab-btn.active { background:#667eea; color:#fff; box-shadow:0 4px 12px rgba(102,126,234,.3); }
    .tab-content { display:none; }
    .tab-content.active { display:block; }

    .input-section { margin-bottom:40px; }
    .input-group { display:flex; gap:15px; margin-bottom:20px; }
    .controls-row { display:flex; gap:15px; margin-bottom:20px; flex-wrap:wrap; align-items:center; }
    .filter-group, .proxy-group, .carousel-group { display:flex; align-items:center; gap:10px; }
    .filter-group label, .proxy-group label, .carousel-group label { font-weight:600; color:#333; white-space:nowrap; }

    input[type=url] { flex:1; padding:15px 20px; border:2px solid #e1e5e9; border-radius:12px; font-size:16px; transition:.3s; }
    input[type=url]:focus { outline:none; border-color:#667eea; box-shadow:0 0 0 4px rgba(102,126,234,.1); }

    select { padding:12px 16px; border:2px solid #e1e5e9; border-radius:10px; font-size:14px; background:#fff; cursor:pointer; transition:.3s; }
    select:focus { outline:none; border-color:#667eea; }

    .filter-checkboxes { display:flex; gap:15px; flex-wrap:wrap; }
    .checkbox-item { display:flex; align-items:center; gap:5px; background:#f8f9fa; padding:8px 12px; border-radius:8px; transition:.3s; }
    .checkbox-item:hover { background:#e9ecef; }
    .checkbox-item input[type=checkbox] { margin:0; }
    .checkbox-item label { font-weight:normal; margin:0; cursor:pointer; }

    .extract-btn { background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; border:none; padding:16px 32px; border-radius:12px; font-size:16px; font-weight:600; cursor:pointer; transition:.3s; white-space:nowrap; position:relative; overflow:hidden; }
    .extract-btn:hover { transform:translateY(-2px); box-shadow:0 12px 24px rgba(102,126,234,.4); }
    .extract-btn:disabled { background:#ccc; cursor:not-allowed; transform:none; }

    .clean-btn { background:linear-gradient(135deg,#ffc107,#e0a800); color:#212529; border:none; padding:16px 24px; border-radius:12px; font-size:16px; font-weight:600; cursor:pointer; transition:.3s; white-space:nowrap; }
    .clean-btn:hover { transform:translateY(-2px); box-shadow:0 12px 24px rgba(255,193,7,.4); }

    .log-panel { background:#f8f9fa; border:2px solid #667eea; border-radius:12px; padding:15px; margin:15px 0; height:120px; overflow-y:auto; font-family:'Courier New',monospace; font-size:13px; color:#333; }
    .log-panel .log-info { color:#007bff; }
    .log-panel .log-success { color:#28a745; }
    .log-panel .log-error { color:#dc3545; }
    .log-panel .log-warning { color:#ffc107; }

    .loading { display:none; text-align:center; padding:30px; }
    .spinner { width:60px; height:60px; border:6px solid #f3f3f3; border-top:6px solid #667eea; border-radius:50%; animation:spin 1s linear infinite; margin:0 auto 20px; }
    @keyframes spin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }

    .results { margin-top:30px; }
    .status { padding:16px 20px; border-radius:12px; margin-bottom:20px; font-weight:500; border:2px solid transparent; }
    .status.success { background:linear-gradient(135deg,#d4edda,#c3e6cb); color:#155724; border-color:#c3e6cb; }
    .status.error { background:linear-gradient(135deg,#f8d7da,#f5c6cb); color:#721c24; border-color:#f5c6cb; }
    .status.info { background:linear-gradient(135deg,#d1ecf1,#bee5eb); color:#0c5460; border-color:#bee5eb; }
    .status.warning { background:linear-gradient(135deg,#fff3cd,#ffeaa7); color:#856404; border-color:#ffeaa7; }

    .stats-dashboard { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin:20px 0; }
    .stat-card { background:linear-gradient(135deg,#f8f9fa,#e9ecef); border-radius:16px; padding:20px; text-align:center; transition:.3s; border:2px solid transparent; }
    .stat-card:hover { transform:translateY(-4px); box-shadow:0 8px 25px rgba(0,0,0,.1); border-color:#667eea; }
    .stat-number { font-size:2.5em; font-weight:bold; color:#667eea; margin-bottom:8px; }
    .stat-label { font-size:1.1em; color:#666; font-weight:500; }

    .media-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:25px; margin-top:25px; }
    .media-card { background:#fff; border-radius:16px; padding:20px; box-shadow:0 8px 25px rgba(0,0,0,.08); transition:.4s; position:relative; border:2px solid transparent; overflow:hidden; }
    .media-card:hover { transform:translateY(-8px); box-shadow:0 15px 40px rgba(0,0,0,.15); border-color:#667eea; }
    .media-card::before { content:''; position:absolute; top:0; left:0; right:0; height:4px; background:linear-gradient(90deg,#667eea,#764ba2); }

    .media-preview { width:100%; height:220px; object-fit:cover; border-radius:12px; margin-bottom:16px; cursor:pointer; background:linear-gradient(135deg,#f8f9fa,#e9ecef); transition:.3s; }
    .media-preview:hover { transform:scale(1.02); }

    .media-info { margin-bottom:16px; }
    .media-url { font-size:.85em; color:#666; word-break:break-all; margin-bottom:12px; padding:12px; background:linear-gradient(135deg,#f8f9fa,#e9ecef); border-radius:8px; border-left:4px solid #667eea; }
    .media-source { font-size:.75em; color:#888; margin-top:8px; font-style:italic; }

    .media-actions { display:flex; gap:8px; }
    .action-btn { flex:1; border:none; padding:10px 12px; border-radius:8px; font-size:12px; cursor:pointer; font-weight:500; transition:.3s; }
    .download-btn { background:linear-gradient(135deg,#28a745,#20c997); color:#fff; }
    .download-btn:hover { background:linear-gradient(135deg,#218838,#1e7e34); transform:translateY(-1px); }
    .copy-btn { background:linear-gradient(135deg,#6c757d,#495057); color:#fff; }
    .copy-btn:hover { background:linear-gradient(135deg,#5a6268,#343a40); transform:translateY(-1px); }
    .open-btn { background:linear-gradient(135deg,#007bff,#0056b3); color:#fff; }
    .open-btn:hover { background:linear-gradient(135deg,#0056b3,#004085); transform:translateY(-1px); }

    .js-analysis { background:linear-gradient(135deg,#f8f9fa,#e9ecef); border-radius:16px; padding:25px; margin:20px 0; border-left:6px solid #667eea; }
    .js-analysis h4 { color:#667eea; margin-bottom:15px; font-size:1.3em; }
    .js-file-list { max-height:400px; overflow-y:auto; }
    .js-file-item { background:#fff; margin-bottom:12px; padding:15px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.05); }
    .js-file-url { font-weight:600; color:#333; margin-bottom:8px; }
    .js-file-media { font-size:.9em; color:#666; }
    .js-file-media span { background:#667eea; color:#fff; padding:2px 8px; border-radius:12px; margin-right:8px; font-size:.8em; }

    .type-badge { font-size:.7em; padding:4px 8px; border-radius:12px; margin-left:8px; font-weight:bold; }
    .type-image { background:#e3f2fd; color:#1565c0; }
    .type-video { background:#fff3e0; color:#ef6c00; }
    .type-audio { background:#f3e5f5; color:#7b1fa2; }
    .type-document { background:#e8f5e8; color:#2e7d32; }

    .carousel-badge { position:absolute; top:15px; right:15px; background:linear-gradient(135deg,#ff6b6b,#ee5a52); color:#fff; padding:6px 12px; border-radius:16px; font-size:.75em; font-weight:bold; box-shadow:0 4px 12px rgba(255,107,107,.3); }

    .proxy-status { font-size:0.85em; margin-top:8px; padding:6px 12px; border-radius:6px; background:#f8f9fa; }
    .proxy-working { background:#d4edda; color:#155724; }
    .proxy-failed { background:#f8d7da; color:#721c24; }

    .group-header { background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; padding:15px 20px; border-radius:12px; margin:25px 0 15px 0; font-weight:600; display:flex; justify-content:space-between; align-items:center; box-shadow:0 4px 15px rgba(102,126,234,.3); }
    .toggle-group { background:rgba(255,255,255,.2); color:white; border:none; padding:8px 16px; border-radius:8px; cursor:pointer; transition:.3s; }
    .toggle-group:hover { background:rgba(255,255,255,.3); }
    .group-content { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:25px; }
    .group-collapsed .group-content { display:none; }

    .advanced-filters { background:linear-gradient(135deg,#f8f9fa,#e9ecef); border-radius:16px; padding:20px; margin:20px 0; }
    .advanced-filters h4 { color:#667eea; margin-bottom:15px; }
    .filter-row { display:flex; gap:15px; margin-bottom:15px; flex-wrap:wrap; align-items:center; }
    .filter-input { padding:8px 12px; border:2px solid #e1e5e9; border-radius:8px; }

    @media (max-width:768px){
      .input-group, .controls-row, .filter-row { flex-direction:column; }
      .header h1 { font-size:2.2em; }
      .main-content { padding:20px; }
      .media-grid { grid-template-columns:1fr; }
      .tabs-nav { flex-direction:column; }
      .stats-dashboard { grid-template-columns:repeat(2,1fr); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üöÄ Enhanced Media Extractor V5.0 - POTENZIATO</h1>
      <p>Estrazione massiva di contenuti media con algoritmi avanzati e multi-pattern</p>
    </div>

    <div class="main-content">
      <div class="input-section">
        <div class="input-group">
          <input type="url" id="siteUrl" placeholder="Incolla qui l'URL del sito web..." />
          <button class="clean-btn" onclick="cleanUrl()">üßπ Pulisci URL</button>
          <button class="extract-btn" onclick="extractContent()">üîç Analizza Sito</button>
        </div>

        <div class="log-panel" id="logPanel">Log Panel V5.0 - Sistema di estrazione potenziato pronto</div>

        <div class="advanced-filters">
          <h4>üéØ Filtri Avanzati e Modalit√† di Estrazione</h4>
          <div class="filter-row">
            <div class="proxy-group">
              <label for="proxySelect">Proxy:</label>
              <select id="proxySelect">
                <option value="auto">üîÑ Auto (ricerca intelligente)</option>
                <option value="noproxy">üöÄ NoProxy (Accesso Diretto)</option>
                <option value="corsproxy">üåê CorsProxy</option>
                <option value="allorigins">üîó AllOrigins</option>
              </select>
              <div class="proxy-status" id="proxyStatus"></div>
            </div>

            <div class="carousel-group">
              <div class="checkbox-item">
                <input type="checkbox" id="carouselMode" checked>
                <label for="carouselMode">üé† Modalit√† Carosello</label>
              </div>
            </div>

            <div class="checkbox-item">
              <input type="checkbox" id="deepExtraction" checked>
              <label for="deepExtraction">‚ö° Estrazione Intensiva</label>
            </div>

            <div class="checkbox-item">
              <input type="checkbox" id="backgroundImages" checked>
              <label for="backgroundImages">üñºÔ∏è Background Images</label>
            </div>
          </div>

          <div class="filter-row">
            <div class="filter-group">
              <label>Tipi Media:</label>
              <div class="filter-checkboxes">
                <div class="checkbox-item">
                  <input type="checkbox" id="filterImg" checked>
                  <label for="filterImg">üì∑ Immagini</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="filterVideo" checked>
                  <label for="filterVideo">üé• Video</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="filterAudio" checked>
                  <label for="filterAudio">üéµ Audio</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="filterDoc" checked>
                  <label for="filterDoc">üìÑ Documenti</label>
                </div>
              </div>
            </div>
          </div>

          <div class="filter-row">
            <label>Dimensione minima (px):</label>
            <input type="number" class="filter-input" id="minSize" value="50" min="0" max="5000">
            <label>Modalit√† estrazione:</label>
            <select class="filter-input" id="extractionMode">
              <option value="aggressive">üî• Aggressiva (Max contenuti)</option>
              <option value="standard">‚ö° Standard</option>
              <option value="conservative">üõ°Ô∏è Conservativa</option>
            </select>
          </div>
        </div>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p id="loadingText">Estrazione intensiva in corso...</p>
      </div>

      <div class="tabs-container" id="tabsContainer" style="display:none;">
        <div class="tabs-nav">
          <button class="tab-btn active" onclick="switchTab(event, 'media')">üì∏ Media Trovati</button>
          <button class="tab-btn" onclick="switchTab(event, 'javascript')">‚öôÔ∏è Analisi JavaScript</button>
          <button class="tab-btn" onclick="switchTab(event, 'stats')">üìä Statistiche Dettagliate</button>
        </div>

        <div class="tab-content active" id="mediaTab">
          <div id="mediaResults"></div>
        </div>

        <div class="tab-content" id="javascriptTab">
          <div id="jsResults"></div>
        </div>

        <div class="tab-content" id="statsTab">
          <div id="statsResults"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let extractionData = { media: [], jsFiles: [], stats: {}, usedProxy: null };

    // Funzione per il logging potenziata
    function addLog(message, type = 'info') {
      console.log(`[${type.toUpperCase()}] ${message}`);
      
      try {
        const logPanel = document.getElementById('logPanel');
        if (!logPanel) return;
        
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement('div');
        logEntry.className = `log-${type}`;
        logEntry.textContent = `${timestamp} - ${message}`;
        logPanel.appendChild(logEntry);
        logPanel.scrollTop = logPanel.scrollHeight;

        // Limita numero di log per performance
        if (logPanel.children.length > 100) {
          logPanel.removeChild(logPanel.firstChild);
        }
      } catch (e) {
        console.error('Errore nel log panel:', e);
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      addLog('Sistema V5.0 inizializzato - Algoritmi di estrazione potenziati attivi', 'success');
    });

    function cleanUrl() {
      try {
        const urlInput = document.getElementById('siteUrl');
        const originalUrl = urlInput.value.trim();
        
        if (!originalUrl) {
          addLog('Nessun URL da pulire', 'warning');
          return;
        }
        
        addLog(`URL originale: ${originalUrl}`, 'info');
        const cleanedUrl = originalUrl.split('?')[0].split('#')[0];
        urlInput.value = cleanedUrl;
        addLog(`URL pulito: ${cleanedUrl}`, 'success');
      } catch (e) {
        addLog(`Errore nella pulizia URL: ${e.message}`, 'error');
      }
    }

    function switchTab(event, tabName) {
      try {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        if (event && event.target) {
          event.target.classList.add('active');
        }
        
        const tabElement = document.getElementById(tabName + 'Tab');
        if (tabElement) {
          tabElement.classList.add('active');
        }
        
        addLog(`Cambiato tab: ${tabName}`, 'info');
      } catch (e) {
        addLog(`Errore nel cambio tab: ${e.message}`, 'error');
      }
    }

    async function findWorkingProxies() {
      const sources = [
        'https://api.allorigins.win/raw?url=https://httpbin.org/ip',
        'https://corsproxy.io/?https://httpbin.org/ip'
      ];
      
      const working = [];
      addLog('Ricerca proxy ottimizzata V5.0...', 'info');
      
      for (const src of sources) {
        try {
          const proxyName = src.includes('allorigins') ? 'AllOrigins' : 'CorsProxy';
          addLog(`Test proxy: ${proxyName}`, 'info');
          
          const response = await Promise.race([
            fetch(src, { 
              method: 'GET',
              headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
              }
            }),
            new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 8000))
          ]);
          
          if (response.ok) {
            const baseUrl = src.includes('allorigins') ? 
              'https://api.allorigins.win/raw?url=' : 'https://corsproxy.io/?';
            working.push(baseUrl);
            addLog(`‚úÖ Proxy verificato: ${proxyName}`, 'success');
          }
        } catch (e) {
          addLog(`‚ùå Proxy fallito: ${e.message}`, 'error');
        }
      }
      
      return working;
    }

    async function fetchWithNoProxy(url) {
      addLog('Tentativo accesso diretto ottimizzato...', 'info');
      
      try {
        const response = await Promise.race([
          fetch(url, {
            method: 'GET',
            headers: {
              'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
              'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
              'Accept-Language': 'en-US,en;q=0.9,it;q=0.8'
            },
            mode: 'cors'
          }),
          new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout accesso diretto')), 15000))
        ]);
        
        if (response.ok) {
          return await response.text();
        } else {
          throw new Error(`HTTP ${response.status} - ${response.statusText}`);
        }
      } catch (e) {
        throw new Error(`Accesso diretto fallito: ${e.message}`);
      }
    }

    function getMediaType(url) {
      const u = url.toLowerCase();
      if (/\.(jpe?g|png|gif|webp|svg|bmp|tiff?|avif|ico|heic|heif)(\?|#|$)/i.test(u)) return 'image';
      if (/\.(mp4|mov|avi|mkv|webm|m4v|3gp|flv|wmv|ogv|m3u8|ts)(\?|#|$)/i.test(u)) return 'video';
      if (/\.(mp3|wav|ogg|m4a|aac|flac|wma|opus)(\?|#|$)/i.test(u)) return 'audio';
      if (/\.(pdf|doc|docx|xls|xlsx|ppt|pptx|txt|rtf)(\?|#|$)/i.test(u)) return 'document';
      return 'unknown';
    }

    // ALGORITMO DI ESTRAZIONE POTENZIATO V5.0
    function extractMediaAdvanced(html, baseUrl, filters) {
      const media = [];
      const seen = new Set();
      const mode = document.getElementById('extractionMode').value;
      
      addLog(`üî• AVVIO ESTRAZIONE POTENZIATA V5.0 - Modalit√†: ${mode.toUpperCase()}`, 'info');
      
      try {
        // 1. PATTERN REGEX ESTESI E MULTIPLI
        const extensivePatterns = [
          // Immagini - Pattern base e avanzati
          /https?:\/\/[^"'\s)}<]+\.(?:jpe?g|png|gif|webp|svg|bmp|tiff?|avif|ico|heic)(?:\?[^"'\s)}<]*)?/gi,
          
          // Video - Esteso con formati streaming
          /https?:\/\/[^"'\s)}<]+\.(?:mp4|mov|avi|mkv|webm|m4v|3gp|flv|wmv|ogv|m3u8|ts)(?:\?[^"'\s)}<]*)?/gi,
          
          // Audio - Formati completi
          /https?:\/\/[^"'\s)}<]+\.(?:mp3|wav|ogg|m4a|aac|flac|wma|opus)(?:\?[^"'\s)}<]*)?/gi,
          
          // Pattern generici per domini media
          /https?:\/\/(?:.*\.)?(?:imgur|flickr|instagram|youtube|vimeo|soundcloud|spotify)\.com\/[^"'\s)}<]+/gi,
          
          // Pattern per CDN e servizi cloud
          /https?:\/\/[^"'\s)}<]*(?:amazonaws|cloudfront|akamai|fastly|jsdelivr)\.(?:com|net)\/[^"'\s)}<]+\.(?:jpe?g|png|gif|webp|svg|mp4|webm|mp3|wav)(?:\?[^"'\s)}<]*)?/gi,
        ];
        
        let patternCount = 0;
        extensivePatterns.forEach((pattern, i) => {
          let match;
          while ((match = pattern.exec(html)) !== null) {
            const url = match[0].replace(/['">\s}]+$/, ''); // Pulisce caratteri finali
            if (url && !seen.has(url) && url.startsWith('http') && url.length > 10) {
              seen.add(url);
              const type = getMediaType(url);
              if (shouldIncludeMedia(url, filters, type)) {
                media.push({
                  url: url,
                  alt: `Advanced Pattern ${i + 1}`,
                  source: `Regex Pattern ${i + 1}`,
                  type: type,
                  isCarousel: false
                });
                patternCount++;
              }
            }
          }
        });
        
        addLog(`‚úÖ Pattern Regex: ${patternCount} media estratti`, 'success');
        
        // 2. PARSING DOM APPROFONDITO
        let domCount = 0;
        const doc = new DOMParser().parseFromString(html, 'text/html');
        
        if (filters.images) {
          // Immagini da tag IMG
          const images = doc.querySelectorAll('img[src], img[data-src], img[data-original], img[data-lazy], img[data-srcset]');
          images.forEach((img, i) => {
            const sources = [
              img.src,
              img.getAttribute('data-src'),
              img.getAttribute('data-original'),
              img.getAttribute('data-lazy'),
              img.getAttribute('srcset')?.split(',')[0]?.split(' ')[0]
            ].filter(Boolean);
            
            sources.forEach(src => {
              if (src && src.startsWith('http') && !seen.has(src)) {
                seen.add(src);
                media.push({
                  url: src,
                  alt: img.alt || `DOM Image ${i + 1}`,
                  source: 'DOM IMG Tag',
                  type: 'image',
                  isCarousel: img.closest('.carousel, .slider, .swiper, .gallery') !== null
                });
                domCount++;
              }
            });
          });
          
          // Background images da CSS inline e computed styles
          if (filters.backgroundImages) {
            const elementsWithBg = doc.querySelectorAll('*[style*="background"], div, section, header');
            elementsWithBg.forEach((el, i) => {
              const style = el.getAttribute('style') || '';
              const bgMatches = style.match(/background[^:]*:\s*url\(['"]?([^'")\s]+)['"]?\)/gi);
              if (bgMatches) {
                bgMatches.forEach(match => {
                  const urlMatch = match.match(/url\(['"]?([^'")\s]+)['"]?\)/i);
                  if (urlMatch && urlMatch[1] && urlMatch[1].startsWith('http') && !seen.has(urlMatch[1])) {
                    seen.add(urlMatch[1]);
                    media.push({
                      url: urlMatch[1],
                      alt: `Background Image ${i + 1}`,
                      source: 'CSS Background',
                      type: 'image',
                      isCarousel: false
                    });
                    domCount++;
                  }
                });
              }
            });
          }
        }
        
        if (filters.videos) {
          // Video da tag VIDEO e SOURCE
          const videos = doc.querySelectorAll('video[src], video source[src], video[data-src]');
          videos.forEach((vid, i) => {
            const sources = [
              vid.src,
              vid.getAttribute('data-src'),
              vid.getAttribute('poster')
            ].filter(Boolean);
            
            sources.forEach(src => {
              if (src && src.startsWith('http') && !seen.has(src)) {
                seen.add(src);
                media.push({
                  url: src,
                  alt: `Video Source ${i + 1}`,
                  source: 'DOM VIDEO Tag',
                  type: getMediaType(src),
                  isCarousel: false
                });
                domCount++;
              }
            });
          });
        }
        
        if (filters.audio) {
          // Audio da tag AUDIO
          const audios = doc.querySelectorAll('audio[src], audio source[src]');
          audios.forEach((aud, i) => {
            const src = aud.src || aud.getAttribute('src');
            if (src && src.startsWith('http') && !seen.has(src)) {
              seen.add(src);
              media.push({
                url: src,
                alt: `Audio Source ${i + 1}`,
                source: 'DOM AUDIO Tag',
                type: 'audio',
                isCarousel: false
              });
              domCount++;
            }
          });
        }
        
        addLog(`‚úÖ Parsing DOM: ${domCount} media estratti`, 'success');
        
        // 3. ESTRAZIONE DA JSON-LD E METADATA
        let metadataCount = 0;
        if (mode === 'aggressive') {
          const scripts = doc.querySelectorAll('script[type="application/ld+json"], script:not([src])');
          scripts.forEach(script => {
            try {
              if (script.type === 'application/ld+json') {
                const data = JSON.parse(script.textContent);
                extractFromJsonLD(data, media, seen);
              } else {
                // Cerca URL in JavaScript inline
                const jsContent = script.textContent;
                const jsUrls = jsContent.match(/https?:\/\/[^"'\s]+\.(?:jpe?g|png|gif|webp|mp4|webm|mp3|wav)(?:\?[^"'\s]*)?/gi);
                if (jsUrls) {
                  jsUrls.forEach(url => {
                    if (!seen.has(url)) {
                      seen.add(url);
                      const type = getMediaType(url);
                      if (shouldIncludeMedia(url, filters, type)) {
                        media.push({
                          url: url,
                          alt: 'JavaScript Embedded',
                          source: 'JavaScript Code',
                          type: type,
                          isCarousel: false
                        });
                        metadataCount++;
                      }
                    }
                  });
                }
              }
            } catch (e) {
              // Ignora errori di parsing JSON
            }
          });
          
          // Meta tags per immagini social
          const metaTags = doc.querySelectorAll('meta[property*="image"], meta[name*="image"], meta[property*="video"], meta[name*="video"]');
          metaTags.forEach(meta => {
            const content = meta.getAttribute('content');
            if (content && content.startsWith('http') && !seen.has(content)) {
              seen.add(content);
              const type = getMediaType(content);
              if (shouldIncludeMedia(content, filters, type)) {
                media.push({
                  url: content,
                  alt: 'Social Media Meta',
                  source: 'Meta Tag',
                  type: type,
                  isCarousel: false
                });
                metadataCount++;
              }
            }
          });
          
          addLog(`‚úÖ Metadata/JSON-LD: ${metadataCount} media estratti`, 'success');
        }
        
        // 4. ESTRAZIONE DA ATTRIBUTI DATA-* E LAZY LOADING
        let lazyCount = 0;
        if (filters.deepExtraction) {
          const lazyElements = doc.querySelectorAll('[data-src], [data-original], [data-lazy], [data-srcset], [data-bg], [data-background]');
          lazyElements.forEach((el, i) => {
            const dataSources = [
              el.getAttribute('data-src'),
              el.getAttribute('data-original'),
              el.getAttribute('data-lazy'),
              el.getAttribute('data-srcset')?.split(',')[0]?.split(' ')[0],
              el.getAttribute('data-bg'),
              el.getAttribute('data-background')
            ].filter(Boolean);
            
            dataSources.forEach(src => {
              if (src && src.startsWith('http') && !seen.has(src)) {
                seen.add(src);
                const type = getMediaType(src);
                if (shouldIncludeMedia(src, filters, type)) {
                  media.push({
                    url: src,
                    alt: `Lazy Load ${i + 1}`,
                    source: 'Lazy Loading',
                    type: type,
                    isCarousel: el.closest('.carousel, .slider, .swiper, .gallery') !== null
                  });
                  lazyCount++;
                }
              }
            });
          });
          
          addLog(`‚úÖ Lazy Loading: ${lazyCount} media estratti`, 'success');
        }
        
        // 5. RIMOZIONE DUPLICATI E FILTRI FINALI
        const uniqueMedia = [];
        const finalSeen = new Set();
        
        media.forEach(item => {
          const cleanUrl = item.url.split('?')[0].split('#')[0];
          if (!finalSeen.has(cleanUrl) && isValidMediaUrl(item.url)) {
            finalSeen.add(cleanUrl);
            uniqueMedia.push(item);
          }
        });
        
        addLog(`üéâ ESTRAZIONE COMPLETATA: ${uniqueMedia.length} media unici trovati!`, 'success');
        addLog(`üìä Dettagli: Regex(${patternCount}) + DOM(${domCount}) + Metadata(${metadataCount}) + Lazy(${lazyCount})`, 'info');
        
        return uniqueMedia;
        
      } catch (e) {
        addLog(`‚ùå Errore nell'estrazione avanzata: ${e.message}`, 'error');
        return media;
      }
    }
    
    // Estrae media da JSON-LD strutturato
    function extractFromJsonLD(data, media, seen) {
      try {
        if (Array.isArray(data)) {
          data.forEach(item => extractFromJsonLD(item, media, seen));
          return;
        }
        
        if (typeof data === 'object' && data !== null) {
          // Cerca propriet√† immagine/video comuni
          const mediaProps = ['image', 'video', 'audio', 'thumbnail', 'logo', 'photo', 'contentUrl', 'embedUrl', 'url'];
          
          mediaProps.forEach(prop => {
            if (data[prop]) {
              let urls = Array.isArray(data[prop]) ? data[prop] : [data[prop]];
              urls.forEach(item => {
                let url = typeof item === 'string' ? item : item?.url || item?.contentUrl;
                if (url && url.startsWith('http') && !seen.has(url)) {
                  seen.add(url);
                  media.push({
                    url: url,
                    alt: 'JSON-LD Structured Data',
                    source: 'JSON-LD',
                    type: getMediaType(url),
                    isCarousel: false
                  });
                }
              });
            }
          });
          
          // Ricorsione per oggetti nested
          Object.values(data).forEach(value => {
            if (typeof value === 'object') {
              extractFromJsonLD(value, media, seen);
            }
          });
        }
      } catch (e) {
        // Ignora errori di parsing
      }
    }
    
    // Valida se l'URL √® un media valido
    function isValidMediaUrl(url) {
      try {
        const urlObj = new URL(url);
        const pathname = urlObj.pathname.toLowerCase();
        
        // Esclude URL troppo generici o non media
        if (pathname === '/' || pathname === '') return false;
        if (url.includes('favicon')) return false;
        if (url.includes('logo') && url.length < 50) return false;
        
        return true;
      } catch {
        return false;
      }
    }

    function shouldIncludeMedia(url, filters, type) {
      const minSize = parseInt(document.getElementById('minSize').value) || 0;
      
      // Filtro per dimensione (approssimativo basato su URL)
      if (minSize > 100 && (url.includes('thumb') || url.includes('small') || url.includes('mini'))) {
        return false;
      }
      
      switch (type) {
        case 'image':
          return filters.images;
        case 'video':
          return filters.videos;
        case 'audio':
          return filters.audio;
        case 'document':
          return filters.documents;
        default:
          return filters.images; // default per unknown
      }
    }

    function getActiveFilters() {
      return {
        images: document.getElementById('filterImg').checked,
        videos: document.getElementById('filterVideo').checked,
        audio: document.getElementById('filterAudio').checked,
        documents: document.getElementById('filterDoc').checked,
        carouselMode: document.getElementById('carouselMode').checked,
        deepExtraction: document.getElementById('deepExtraction').checked,
        backgroundImages: document.getElementById('backgroundImages').checked
      };
    }

    function showStatus(type, message) {
      const statusDiv = document.createElement('div');
      statusDiv.className = `status ${type}`;
      statusDiv.innerHTML = message;
      document.getElementById('mediaResults').appendChild(statusDiv);
    }

    function createMediaCard(media, index) {
      const card = document.createElement('div');
      card.className = 'media-card';
      
      // Badge per carosello
      if (media.isCarousel) {
        const badge = document.createElement('div');
        badge.className = 'carousel-badge';
        badge.textContent = 'CAROUSEL';
        card.appendChild(badge);
      }
      
      // Preview media
      const type = media.type || getMediaType(media.url);
      let preview;
      
      if (type === 'video') {
        preview = document.createElement('video');
        preview.src = media.url;
        preview.controls = true;
        preview.className = 'media-preview';
        preview.style.height = '200px';
      } else if (type === 'audio') {
        preview = document.createElement('audio');
        preview.src = media.url;
        preview.controls = true;
        preview.style.width = '100%';
        preview.style.height = '60px';
      } else {
        preview = document.createElement('img');
        preview.src = media.url;
        preview.className = 'media-preview';
        preview.loading = 'lazy'; // Lazy loading per performance
        preview.onerror = () => {
          preview.src = 'data:image/svg+xml,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="300" height="220" viewBox="0 0 300 220"><rect width="100%" height="100%" fill="#f8f9fa"/><text x="50%" y="50%" text-anchor="middle" dy="0.3em" fill="#6c757d" font-family="Arial" font-size="14">Media non disponibile</text></svg>');
        };
      }
      
      card.appendChild(preview);
      
      // Info media
      const info = document.createElement('div');
      info.className = 'media-info';
      
      const urlDiv = document.createElement('div');
      urlDiv.className = 'media-url';
      urlDiv.innerHTML = `${media.url}<span class="type-badge type-${type}">${type.toUpperCase()}</span>`;
      
      if (media.source) {
        const source = document.createElement('div');
        source.className = 'media-source';
        source.textContent = `Fonte: ${media.source}`;
        urlDiv.appendChild(source);
      }
      
      info.appendChild(urlDiv);
      card.appendChild(info);
      
      // Azioni
      const actions = document.createElement('div');
      actions.className = 'media-actions';
      
      // Download
      const downloadBtn = document.createElement('button');
      downloadBtn.className = 'action-btn download-btn';
      downloadBtn.innerHTML = '‚¨áÔ∏è Download';
      downloadBtn.onclick = () => {
        const a = document.createElement('a');
        a.href = media.url;
        a.download = `media-${type}-${index + 1}`;
        a.target = '_blank';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      };
      
      // Copia
      const copyBtn = document.createElement('button');
      copyBtn.className = 'action-btn copy-btn';
      copyBtn.innerHTML = 'üìã Copia';
      copyBtn.onclick = async () => {
        try {
          await navigator.clipboard.writeText(media.url);
          copyBtn.innerHTML = '‚úÖ Copiato';
          setTimeout(() => copyBtn.innerHTML = 'üìã Copia', 2000);
        } catch {
          copyBtn.innerHTML = '‚ùå Errore';
          setTimeout(() => copyBtn.innerHTML = 'üìã Copia', 2000);
        }
      };
      
      // Apri
      const openBtn = document.createElement('button');
      openBtn.className = 'action-btn open-btn';
      openBtn.innerHTML = 'üîó Apri';
      openBtn.onclick = () => window.open(media.url, '_blank');
      
      actions.appendChild(downloadBtn);
      actions.appendChild(copyBtn);
      actions.appendChild(openBtn);
      card.appendChild(actions);
      
      return card;
    }

    function displayMedia(mediaList) {
      const container = document.getElementById('mediaResults');
      
      if (!mediaList.length) {
        container.innerHTML = '<div class="status warning">‚ö†Ô∏è Nessun media trovato con i filtri attuali. Prova a modificare le impostazioni di estrazione.</div>';
        return;
      }
      
      // Raggruppa per tipo di media
      const groups = {
        'Immagini': mediaList.filter(m => m.type === 'image'),
        'Video': mediaList.filter(m => m.type === 'video'),
        'Audio': mediaList.filter(m => m.type === 'audio'),
        'Documenti': mediaList.filter(m => m.type === 'document'),
        'Altri': mediaList.filter(m => !['image', 'video', 'audio', 'document'].includes(m.type))
      };
      
      // Mostra gruppi con contenuto
      Object.entries(groups).forEach(([groupName, items]) => {
        if (items.length === 0) return;
        
        const groupDiv = document.createElement('div');
        groupDiv.className = 'media-group';
        
        const header = document.createElement('div');
        header.className = 'group-header';
        header.innerHTML = `<span>üìÅ ${groupName} (${items.length} elementi)</span>`;
        
        const toggleBtn = document.createElement('button');
        toggleBtn.className = 'toggle-group';
        toggleBtn.innerHTML = 'üëÅÔ∏è Mostra/Nascondi';
        toggleBtn.onclick = () => {
          groupDiv.classList.toggle('group-collapsed');
          addLog(`Gruppo ${groupName} ${groupDiv.classList.contains('group-collapsed') ? 'nascosto' : 'mostrato'}`, 'info');
        };
        
        header.appendChild(toggleBtn);
        
        const content = document.createElement('div');
        content.className = 'group-content media-grid';
        
        items.forEach((item, i) => {
          content.appendChild(createMediaCard(item, i));
        });
        
        groupDiv.appendChild(header);
        groupDiv.appendChild(content);
        container.appendChild(groupDiv);
      });
    }

    function displayStats() {
      const stats = extractionData.stats;
      const container = document.getElementById('statsResults');
      
      container.innerHTML = `
        <div class="stats-dashboard">
          <div class="stat-card">
            <div class="stat-number">${stats.total || 0}</div>
            <div class="stat-label">Media Totali</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.images || 0}</div>
            <div class="stat-label">Immagini</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.videos || 0}</div>
            <div class="stat-label">Video</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.audio || 0}</div>
            <div class="stat-label">Audio</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.documents || 0}</div>
            <div class="stat-label">Documenti</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${stats.domains || 0}</div>
            <div class="stat-label">Domini</div>
          </div>
        </div>
        <div class="js-analysis">
          <h4>üìã Dettagli Estrazione V5.0</h4>
          <p><strong>üîó Proxy utilizzato:</strong> ${extractionData.usedProxy || 'N/A'}</p>
          <p><strong>üåê Domini trovati:</strong> ${stats.domains || 'N/A'}</p>
          <p><strong>‚ö° Modalit√† estrazione:</strong> ${document.getElementById('extractionMode').value.toUpperCase()}</p>
          <p><strong>üéØ Algoritmi attivi:</strong> Pattern Regex + DOM Parser + Metadata + Lazy Loading</p>
          <p><strong>üîç Fonti analizzate:</strong> IMG tags, CSS backgrounds, JSON-LD, Meta tags, Data attributes</p>
        </div>
      `;
    }

    function displayJavaScriptAnalysis() {
      const container = document.getElementById('jsResults');
      
      container.innerHTML = `
        <div class="js-analysis">
          <h4>‚öôÔ∏è Analisi JavaScript e Estrazione Avanzata</h4>
          <p><strong>üî¨ Algoritmi V5.0 utilizzati:</strong></p>
          <ul style="margin: 15px 0; padding-left: 30px;">
            <li>‚úÖ Pattern Regex Estesi (${extractionData.stats.regexPatterns || 0} pattern)</li>
            <li>‚úÖ DOM Parser Approfondito</li>
            <li>‚úÖ Analisi JSON-LD e Metadata</li>
            <li>‚úÖ Estrazione Background CSS</li>
            <li>‚úÖ Lazy Loading Detection</li>
            <li>‚úÖ Social Media Meta Tags</li>
          </ul>
          <p><strong>üìä Performance:</strong> Estrazione ottimizzata per massimizzare i risultati mantenendo la stabilit√†.</p>
          <p><strong>üéØ Raccomandazione:</strong> Per siti con contenuto dinamico, usa modalit√† "Aggressiva" per migliori risultati.</p>
        </div>
      `;
    }

    async function extractContent() {
      const url = document.getElementById('siteUrl').value.trim();
      const proxySelect = document.getElementById('proxySelect').value;
      const filters = getActiveFilters();
      
      const loadingDiv = document.getElementById('loading');
      const tabsContainer = document.getElementById('tabsContainer');
      const extractBtn = document.querySelector('.extract-btn');
      const loadingText = document.getElementById('loadingText');
      const proxyStatus = document.getElementById('proxyStatus');
      
      // Reset UI
      document.getElementById('mediaResults').innerHTML = '';
      document.getElementById('jsResults').innerHTML = '';
      document.getElementById('statsResults').innerHTML = '';
      
      loadingDiv.style.display = 'block';
      tabsContainer.style.display = 'none';
      extractBtn.disabled = true;
      extractBtn.innerHTML = 'üîÑ Estrazione in corso...';
      proxyStatus.textContent = '';
      
      addLog('=== üöÄ AVVIO ESTRAZIONE POTENZIATA V5.0 ===', 'info');
      
      if (!url) {
        addLog('‚ùå URL mancante o non valido', 'error');
        showStatus('error', 'Per favore inserisci un URL valido');
        loadingDiv.style.display = 'none';
        extractBtn.disabled = false;
        extractBtn.innerHTML = 'üîç Analizza Sito';
        return;
      }
      
      addLog(`üéØ Target URL: ${url}`, 'info');
      addLog(`üîß Proxy: ${proxySelect}, Modalit√†: ${document.getElementById('extractionMode').value}`, 'info');
      
      let html = null;
      let usedProxy = null;
      
      try {
        if (proxySelect === 'noproxy') {
          loadingText.textContent = 'üöÄ Accesso diretto ottimizzato...';
          addLog('üîó Tentativo accesso diretto (NoProxy)...', 'info');
          html = await fetchWithNoProxy(url);
          usedProxy = 'Accesso Diretto (NoProxy)';
          addLog('‚úÖ HTML scaricato con successo via NoProxy', 'success');
        } else {
          let proxies = [];
          
          if (proxySelect === 'auto') {
            loadingText.textContent = 'üîç Ricerca proxy intelligente V5.0...';
            proxyStatus.innerHTML = '<span class="proxy-working">üîÑ Ricerca proxy...</span>';
            proxies = await findWorkingProxies();
            addLog(`üìä Ricerca completata: ${proxies.length} proxy disponibili`, 'info');
          } else if (proxySelect === 'corsproxy') {
            proxies = ['https://corsproxy.io/?'];
            addLog('üåê Uso CorsProxy predefinito', 'info');
          } else if (proxySelect === 'allorigins') {
            proxies = ['https://api.allorigins.win/raw?url='];
            addLog('üîó Uso AllOrigins predefinito', 'info');
          }
          
          for (const proxy of proxies) {
            try {
              const proxyName = proxy.split('/')[2] || proxy;
              loadingText.textContent = `üîç Test proxy: ${proxyName}...`;
              proxyStatus.innerHTML = `<span class="proxy-working">‚è≥ Test: ${proxyName}</span>`;
              addLog(`üß™ Tentativo con proxy: ${proxyName}`, 'info');
              
              const proxyUrl = proxy.includes('?') ? 
                proxy + encodeURIComponent(url) : 
                proxy + url;
              
              const response = await Promise.race([
                fetch(proxyUrl, {
                  headers: {
                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                  }
                }),
                new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout proxy')), 15000))
              ]);
              
              if (response.ok) {
                html = await response.text();
                usedProxy = proxy;
                addLog(`‚úÖ Connessione riuscita (Status: ${response.status}, Size: ${html.length} chars)`, 'success');
                proxyStatus.innerHTML = '<span class="proxy-working">‚úÖ Proxy funzionante</span>';
                break;
              } else {
                addLog(`‚ùå HTTP Error ${response.status}`, 'error');
              }
            } catch (e) {
              addLog(`‚ùå Proxy fallito: ${e.message}`, 'error');
              proxyStatus.innerHTML = '<span class="proxy-failed">‚ùå Proxy fallito</span>';
              
              if (proxySelect !== 'auto') {
                throw new Error(`Proxy ${proxy} non funzionante: ${e.message}`);
              }
            }
          }
          
          if (!html) {
            throw new Error('Tutti i proxy hanno fallito. Prova con "NoProxy" o cambia proxy.');
          }
        }
        
        // ESTRAZIONE MEDIA POTENZIATA V5.0
        loadingText.textContent = 'üî• Estrazione intensiva media in corso...';
        addLog(`üìÑ HTML ricevuto: ${html.length} caratteri`, 'info');
        
        const mediaList = extractMediaAdvanced(html, url, filters);
        
        // Calcolo statistiche dettagliate
        const stats = {
          total: mediaList.length,
          images: mediaList.filter(m => m.type === 'image').length,
          videos: mediaList.filter(m => m.type === 'video').length,
          audio: mediaList.filter(m => m.type === 'audio').length,
          documents: mediaList.filter(m => m.type === 'document').length,
          domains: [...new Set(mediaList.map(m => {
            try {
              return new URL(m.url).hostname;
            } catch {
              return 'unknown';
            }
          }))].length,
          regexPatterns: 5, // Numero di pattern regex utilizzati
          sources: [...new Set(mediaList.map(m => m.source))].length
        };
        
        extractionData = {
          media: mediaList,
          jsFiles: [],
          stats: stats,
          usedProxy: usedProxy || 'Unknown'
        };
        
        // Mostra risultati
        loadingDiv.style.display = 'none';
        extractBtn.disabled = false;
        extractBtn.innerHTML = 'üîç Analizza Sito';
        tabsContainer.style.display = 'block';
        proxyStatus.textContent = '';
        
        if (mediaList.length) {
          addLog(`üéâ ESTRAZIONE COMPLETATA CON SUCCESSO!`, 'success');
          addLog(`üìä RISULTATI: ${mediaList.length} media trovati (Img:${stats.images}, Vid:${stats.videos}, Aud:${stats.audio})`, 'success');
          showStatus('success', `üéâ Trovati ${mediaList.length} media con algoritmi V5.0! Proxy: ${usedProxy?.split('?')[0]?.split('/').pop() || 'Diretto'}`);
          
          displayMedia(mediaList);
          displayJavaScriptAnalysis();
          displayStats();
          
          // Switch automatico al tab media se ci sono risultati
          switchTab({target: document.querySelector('.tab-btn')}, 'media');
        } else {
          addLog('‚ö†Ô∏è Nessun media trovato con i filtri correnti', 'warning');
          addLog('üí° Suggerimento: Prova modalit√† "Aggressiva" o riduci i filtri', 'info');
          showStatus('warning', '‚ö†Ô∏è Nessun media trovato. Prova a modificare i filtri o usa modalit√† "Aggressiva".');
        }
        
      } catch (error) {
        loadingDiv.style.display = 'none';
        extractBtn.disabled = false;
        extractBtn.innerHTML = 'üîç Analizza Sito';
        proxyStatus.innerHTML = '<span class="proxy-failed">‚ùå Errore</span>';
        
        addLog(`‚ùå ERRORE FATALE: ${error.message}`, 'error');
        addLog('üí° Suggerimenti: Verifica URL, prova proxy diverso, o usa NoProxy', 'info');
        showStatus('error', `‚ùå Errore: ${error.message}`);
      }
    }

    // Event listener per Enter
    document.getElementById('siteUrl').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        extractContent();
      }
    });

    // Auto-test dei proxy all'avvio
    document.addEventListener('DOMContentLoaded', async function() {
      addLog('üîß Inizializzazione sistema V5.0...', 'info');
      
      setTimeout(async () => {
        try {
          const proxies = await findWorkingProxies();
          addLog(`‚úÖ Sistema pronto! ${proxies.length} proxy disponibili`, 'success');
        } catch (e) {
          addLog('‚ö†Ô∏è Avviso: Alcuni proxy potrebbero non essere disponibili', 'warning');
        }
      }, 1000);
    });
  </script>
</body>
</html>